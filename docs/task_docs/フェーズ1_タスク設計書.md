# フェーズ1：計画・設計（競艇データ収集基盤）

## 1. フェーズの目的
- スクレイピング基盤の要件定義・設計を確定し、実装フェーズにスムーズに移行できる状態とする。

## 2. 主要タスク
- **データ項目定義とセレクタマッピング**
  - 事前情報／直前情報／結果情報それぞれの必須フィールドと対応するHTMLセレクタを一覧化 **（安定板使用情報を含む）**
  - URLパラメータ（hd, jcd, rno）からの値抽出ルール定義

- **データソース構造分析**
  - Beautiful SoupによるDOM構造調査および動的ロードの有無確認
  - HTTPリクエストパラメータとレスポンス形式の把握

- **クロールポリシー確認**
  - `/owpc/pc/race/…`配下のrobots.txtおよびサイト利用規約の確認
  - スクレイピング許可範囲・アクセス頻度制限の把握

- **開催地コードマッピング**
  - jcd（1～24）→ 競艇場名（桐生、戸田、…、大村）対応表の作成
  - 休催日や欠場レース判定ルールの定義

- **データベーススキーマ設計**
  - テーブル構造、主キー／外部キー、データ型の定義 **（安定板使用カラムを含む）**
  - ER図作成およびSQLAlchemyマッピング案の検討

- **プロトタイプ実装（PoC）**
  - Beautiful Soupを使った出走表／直前情報／結果情報のサンプルスクレイピング **（安定板使用情報の取得を含む）**
  - 取得データをDBスキーマに投入する一連のフロー検証

- **設計ドキュメント作成**
  - セレクタマッピング一覧、DBスキーマ定義書（ER図・DDL）、Beautiful Soupサンプルコード構成案
  - 本設計書および関連資料のMarkdown化

## 3. 受け入れ基準
- 各タスク成果物（マッピング表／スキーマ定義／プロトタイプコード／ドキュメント）がレビュー可能な状態であること。
- レビューを通過し、フェーズ2（開発）へ移行するための判断材料が揃っていること。

## 4. 成果物
1. セレクタマッピング一覧（Markdown）
2. データベーススキーマ定義書（ER図・DDL）
3. Beautiful Soupサンプルスクリプト（出走表・直前情報・結果）
4. 設計ドキュメント一式（本ファイルおよび関連資料）

## 5. 開発環境・使用技術
- **言語**: Python 3.x
- **スクレイピング**: Beautiful Soup
- **DB**: SQLite（SQLAlchemy）
- **ドキュメント**: Markdown

## 6. タスク分解 (WBS)
| No.    | タスク                              |
| ------ | ----------------------------------- |
| 6.1    | データ項目定義・セレクタマッピング |
| 6.2    | データソース構造分析               |
| 6.3    | クロールポリシー確認               |
| 6.4    | 開催地コードマッピング             |
| 6.5    | DBスキーマ設計                     |
| 6.6    | プロトタイプ実装                   |
| 6.7    | 設計ドキュメント作成               |

## 7. リスクと課題
- **ページ構造変更リスク**: DOMが変更された場合の影響範囲が大きいため、セレクタの抽象化・設定ファイル化で柔軟に対応。  
- **スクレイピング禁止リスク**: 利用規約やrobots.txtで禁止となるケースを想定し、アクセス頻度とタイミングを調整。  
- **依存技術の学習コスト**: Beautiful Soupの学習曲線を考慮し、事前に社内勉強会やサンプルコードでキャッチアップを実施。 